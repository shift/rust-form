# Component Manifest Schema

## Overview

Component manifests define the metadata, dependencies, and capabilities of rust-form components. Each component must include either `component.yml` or `rustform-component.yml` in its root directory.

## Schema Definition

### Required Fields

```yaml
name: string                    # Component name (kebab-case)
version: string                 # Semantic version (e.g., "1.0.0")
api_compatibility:              # Rust-form API compatibility
  api_version: string           # Target rust-form API version
  min_version: string           # Minimum supported version
  max_version: string           # Maximum tested version (optional)
  required_features: string[]   # Required rust-form features (optional)
  experimental: boolean         # Uses experimental APIs (optional)
files: string[]                 # Files provided/generated by component
```

### Optional Metadata

```yaml
description: string             # Component description
author: string                  # Component author
license: string                 # License (e.g., "MIT", "Apache-2.0")
homepage: string                # Homepage URL
repository: string              # Repository URL
keywords: string[]              # Search keywords

# Component classification
category: string                # Primary category (auth, database, api, etc.)
subcategory: string             # Subcategory for organization
priority: string                # Priority level (low, medium, high, critical)
complexity: string              # Complexity level (low, medium, high)
```

### Dependencies

```yaml
dependencies:
  rust: string[]                # Rust crate dependencies
  nix:                          # Nix environment dependencies
    buildInputs: string[]       # Build-time dependencies
    nativeBuildInputs: string[] # Native build dependencies
    devShell:                   # Development shell packages
      packages: string[]
```

### Templates and Integration

```yaml
templates:                      # Template configuration
  generates: string[]           # Files generated by templates
  requires: string[]            # Required base files

provides:                       # Component interface (optional)
  templates: TemplateSpec[]
  assets: AssetSpec[]
  hooks: HookSpec[]
```

### Configuration Schema

```yaml
config_schema:                  # User configuration schema
  field_name:
    type: string                # Field type (string, integer, boolean, etc.)
    required: boolean           # Is field required
    default: any                # Default value
    description: string         # Field description
    enum: string[]              # Allowed values (for enum types)
    items: string               # Item type for arrays
    properties: object          # Properties for object types
```

### Testing Configuration

```yaml
tests:                          # Test specifications
  unit: string[]                # Unit test names
  integration: string[]         # Integration test names
  compliance: string[]          # Compliance test names
  performance: string[]         # Performance test names
  security: string[]            # Security test names
```

### Documentation

```yaml
documentation:                  # Documentation flags
  compliance_guide: boolean
  dpo_manual: boolean
  api_reference: boolean
  implementation_checklist: boolean
  privacy_notice_template: boolean
  cookie_policy_template: boolean
  data_processing_records: boolean
  breach_response_procedures: boolean
```

### Compliance (For Regulated Components)

```yaml
compliance:
  regulation: string            # Regulation name (e.g., "GDPR")
  articles_implemented: string[] # Implemented articles/sections
  data_categories: string[]     # Data categories handled
  retention_periods: object     # Data retention policies
  security_measures: string[]   # Security measures implemented
```

### Features

```yaml
features:                       # Feature categories
  category_name: string[]       # Features in this category
```

## Complete Example

### Minimal Component

```yaml
name: "simple-logger"
version: "1.0.0"
description: "Simple request logging component"

api_compatibility:
  api_version: "0.1.0"
  min_version: "0.1.0"
  max_version: "0.2.0"

dependencies:
  rust:
    - "tracing = \"0.1\""
    - "serde = { version = \"1.0\", features = [\"derive\"] }"

files:
  - "middleware/logging_middleware.rs"
  - "config/logging_config.rs"

templates:
  generates:
    - "middleware/logging_middleware.rs"
  requires:
    - "error.rs"
```

### Complex Component

```yaml
name: "jwt-authentication"
version: "2.1.0"
description: "Complete JWT authentication system with refresh tokens"
author: "Rust-Form Team"
license: "MIT"
repository: "https://github.com/rust-form/components"
keywords: ["auth", "jwt", "security"]

category: "authentication"
subcategory: "jwt"
priority: "high"
complexity: "medium"

api_compatibility:
  api_version: "0.1.0"
  min_version: "0.1.0"
  max_version: "0.2.0"
  required_features:
    - "auth-framework"
    - "crypto-utils"
  experimental: false

dependencies:
  rust:
    - "jsonwebtoken = \"9.0\""
    - "serde = { version = \"1.0\", features = [\"derive\"] }"
    - "tokio = { version = \"1.0\", features = [\"full\"] }"
    - "chrono = { version = \"0.4\", features = [\"serde\"] }"
  nix:
    buildInputs:
      - "openssl"
      - "pkg-config"
    nativeBuildInputs:
      - "rustc"
      - "cargo"
    devShell:
      packages:
        - "rust-analyzer"
        - "cargo-watch"

files:
  - "handlers/auth_handler.rs"
  - "middleware/jwt_middleware.rs"
  - "models/token.rs"
  - "models/user_claims.rs"
  - "services/token_service.rs"

templates:
  generates:
    - "handlers/auth_handler.rs"
    - "middleware/jwt_middleware.rs"
    - "models/token.rs"
  requires:
    - "database.rs"
    - "error.rs"

config_schema:
  secret_key:
    type: "string"
    required: true
    description: "JWT signing secret key"
  token_lifetime:
    type: "string"
    default: "24h"
    description: "Token expiration time"
  refresh_enabled:
    type: "boolean"
    default: true
    description: "Enable refresh token functionality"
  algorithm:
    type: "string"
    enum: ["HS256", "HS384", "HS512", "RS256"]
    default: "HS256"
    description: "JWT signing algorithm"

tests:
  unit:
    - "test_token_creation"
    - "test_token_validation"
    - "test_token_expiration"
    - "test_refresh_token_flow"
  integration:
    - "test_auth_middleware"
    - "test_login_endpoint"
    - "test_protected_routes"
  security:
    - "test_invalid_signatures"
    - "test_timing_attacks"
    - "test_token_leakage"

documentation:
  api_reference: true
  implementation_checklist: true

features:
  authentication:
    - "jwt_tokens"
    - "refresh_tokens"
    - "automatic_renewal"
    - "multiple_algorithms"
  security:
    - "signature_validation"
    - "expiration_checks"
    - "secure_defaults"
```

## Validation Rules

### Field Requirements
- `name` must be kebab-case (lowercase with hyphens)
- `version` must follow semantic versioning (major.minor.patch)
- `api_compatibility.api_version` and `api_compatibility.min_version` must be valid semver
- `files` array cannot be empty
- All file paths in `files` and `templates.generates` must be relative paths

### API Compatibility
- `min_version` cannot be greater than `max_version`
- `api_version` should be within the range of `min_version` to `max_version`
- `required_features` must be valid rust-form feature names

### Dependencies
- Rust dependencies must use valid Cargo.toml syntax
- Nix packages must be valid nixpkgs package names

### Configuration Schema
- `type` must be one of: string, integer, boolean, array, object
- Required fields cannot have default values
- Enum values must match the specified type

## Integration with Rust-form

### Manifest Discovery
Rust-form searches for component manifests in this order:
1. `rustform-component.yml`
2. `component.yml`

### Validation
All component manifests are validated against this schema during:
- Component testing (`rustform component test`)
- Project generation (`rustform generate`)
- Component installation

### Testing Framework
The testing framework uses manifest metadata to:
- Validate component structure
- Check API compatibility
- Generate test applications
- Assess component quality

## Schema Version
This schema corresponds to rust-form API version 0.1.0 and is compatible with component manifests for rust-form versions 0.1.0 to 0.2.0.